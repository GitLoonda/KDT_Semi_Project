<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mini.mapper.BoardMapper">
	<select id="selectUserlist" parameterType="hashmap" resultType="com.mini.model.User">
	SELECT
		ID,
		PASSWD,
		NAME,
		NICK,
		GENDER,
		BIRTH,
		PHONE,
		EMAIL,
		ADDR,
		GRADE,
		CGRADE,
		POINT,
		BANCNT1,
		BANCNT2,
		PWCONT,
		AUTH1YN,
		AUTH2YN,
		CREAFLG,
		ADMINFLG,
		USTATUS
	FROM T3_USER
	</select>
<!-- trade.do -->
<!-- 게시글 리스트 -->
<select id="selectTbrdListInfo" parameterType="hashmap" resultType="com.mini.model.TbrdList">
	SELECT
		B.TBNO AS TBNO,
		ID,
		BPRICE,
		substring(BTITLE,1,8) AS BTITLE,
		HITS,
		LIKES,
		D1.CINFO AS BRDNAME,
		D2.CINFO AS KINDNAME,
		D3.CINFO AS CATE1NAME,
		D4.CINFO AS CATE2NAME,
		D5.CINFO AS CATE3NAME,
		D7.CINFO AS BSTATUSNAME,
		T1.PATH AS PATH,
		CDATE,
		UDATE,
		DELYN
	FROM T3_TBRD B
	INNER JOIN T3_DESC D1 ON B.BRDFLG = D1.CNUM
	INNER JOIN T3_DESC D2 ON B.KIND = D2.CNUM
	INNER JOIN T3_DESC D3 ON B.CATE1 = D3.CNUM
	INNER JOIN T3_DESC D4 ON B.CATE2 = D4.CNUM
	INNER JOIN T3_DESC D5 ON B.CATE3 = D5.CNUM
	INNER JOIN T3_DESC D7 ON B.BSTATUS = D7.CNUM
	LEFT JOIN (SELECT TBNO,PATH,REP FROM T3_TIMG WHERE REP='Y') T1 ON B.TBNO = T1.TBNO
	WHERE DELYN="N"
	ORDER BY TBNO DESC LIMIT #{startNum}, #{lastNum}
	
</select>


<select id="selectTbrdListCnt" parameterType="hashmap" resultType="int">
	SELECT
		COUNT(TBNO) AS TBRDCNT
	FROM T3_TBRD
	WHERE DELYN="N"
</select>

<!-- tradeadd.do -->
<!-- 카테고리 리스트  -->
<select id="selectTbrdListbrdf" parameterType="hashmap" resultType="com.mini.model.DescList">
	SELECT 
		CNUM,
		CINFO
	FROM T3_DESC WHERE CID="BRDFLG"

</select>
<select id="selectTbrdListkindf" parameterType="hashmap" resultType="com.mini.model.DescList">
	SELECT 
		CNUM,
		CINFO
	FROM T3_DESC WHERE CID="KIND" AND PCOMM1=#{pcomm1}

</select>
<select id="selectTbrdListcate1" parameterType="hashmap" resultType="com.mini.model.DescList">
	SELECT 
		CNUM,
		CINFO
	FROM T3_DESC WHERE CID="CATE1"

</select>
<select id="selectTbrdListcate2" parameterType="hashmap" resultType="com.mini.model.DescList">
	SELECT 
		CNUM,
		CINFO,
		PCOMM1
	FROM T3_DESC WHERE CID="CATE2" AND PCOMM1=#{pcomm1}

</select>

<select id="selectTbrdListcate3" parameterType="hashmap" resultType="com.mini.model.DescList">
	SELECT 
		CNUM,
		CINFO
	FROM T3_DESC WHERE CID="CATE3"

</select>
<select id="selectUserInfo" parameterType="hashmap" resultType="com.mini.model.User">
	SELECT 
	PHONE,
	EMAIL,
	CREAFLG
	FROM T3_USER WHERE ID=#{userid}
</select>


<select id="selectTbrdListlocal1" parameterType="hashmap" resultType="com.mini.model.Area">
	SELECT 
		DISTINCT(si) AS si
	FROM T_AREA;

</select>
<select id="selectTbrdListlocal2" parameterType="hashmap" resultType="com.mini.model.Area">
	SELECT 
		DISTINCT(gu) AS gu
	FROM T_AREA WHERE si=#{local1name}
	ORDER BY gu ASC
</select>
<select id="selectTbrdListlocal3" parameterType="hashmap" resultType="com.mini.model.Area">
	SELECT 
		DISTINCT(dong) AS dong
	FROM T_AREA WHERE si=#{local1name} and gu=#{local2name}
	ORDER BY dong ASC
</select>

<!-- 게시글 등록 -->
<insert id="TradeAdd" parameterType="hashmap" >
	INSERT INTO T3_TBRD
	VALUES (NULL, #{id}, #{bprice}, #{btitle}, #{bcont}, 0, 0,
		#{brdflg}, #{kind}, #{cate1}, #{cate2}, #{cate3},
		#{bprod}, #{bpros}, #{bstatus}, #{bpur}, #{bbox},
		#{brcpt}, #{bcms}, #{local1}, #{local2}, #{local3},
		NOW(), NULL, 'N')
</insert>

<select id="selectAddTbno" parameterType="hashmap" resultType="int">
	SELECT TBNO 
	FROM T3_TBRD
	ORDER BY TBNO DESC LIMIT 1
</select>

<insert id="TradeImgAdd" parameterType="hashmap" >
	INSERT INTO T3_TIMG
	VALUES (NULL,#{tbno},#{imgpath},#{rep})
</insert>

<!-- tradeview.do -->
<!-- 게시글 상세 -->
<select id="selectTbrdInfo" parameterType="hashmap" resultType="com.mini.model.TbrdList">
	SELECT
		B.TBNO AS TBNO,
		U.ID AS ID,
		NICK,
		PHONE,
		EMAIL,
		BPRICE,
		BTITLE,
		BCONT,
		HITS,
		LIKES,
		GRADE,
		D1.CINFO AS BRDNAME,
		D2.CINFO AS KINDNAME,
		D3.CINFO AS CATE1NAME,
		D4.CINFO AS CATE2NAME,
		D5.CINFO AS CATE3NAME,
		D6.CINFO AS BPRODNAME,
		D7.CINFO AS BPROSNAME,
		D8.CINFO AS BSTATUSNAME,
		D9.CINFO AS BPURNAME,
		D10.CINFO AS BBOXNAME,
		D11.CINFO AS BRCPTNAME,
		D12.CINFO AS BCMSNAME,
		LOCAL1 AS LOCAL1NAME,
		LOCAL2 AS LOCAL2NAME,
		LOCAL3 AS LOCAL3NAME,
		T1.PATH AS PATH,
		B.CDATE AS CDATE,
		UDATE,
		DELYN
	FROM T3_TBRD B
	INNER JOIN T3_USER U ON B.ID = U.ID
	INNER JOIN T3_DESC D1 ON B.BRDFLG = D1.CNUM
	INNER JOIN T3_DESC D2 ON B.KIND = D2.CNUM
	INNER JOIN T3_DESC D3 ON B.CATE1 = D3.CNUM
	INNER JOIN T3_DESC D4 ON B.CATE2 = D4.CNUM
	INNER JOIN T3_DESC D5 ON B.CATE3 = D5.CNUM
	LEFT JOIN T3_DESC D6 ON B.BPROD = D6.CNUM
	LEFT JOIN T3_DESC D7 ON B.BPROS = D7.CNUM
	LEFT JOIN T3_DESC D8 ON B.BSTATUS = D8.CNUM
	LEFT JOIN T3_DESC D9 ON B.BPUR = D9.CNUM
	LEFT JOIN T3_DESC D10 ON B.BBOX = D10.CNUM
	LEFT JOIN T3_DESC D11 ON B.BRCPT = D11.CNUM
	LEFT JOIN T3_DESC D12 ON B.BCMS = D12.CNUM
	LEFT JOIN (SELECT TBNO,PATH,REP FROM T3_TIMG WHERE REP='Y') T1 ON B.TBNO = T1.TBNO
	WHERE B.TBNO = #{tbno}
	ORDER BY TBNO DESC
</select>

<!-- 게시글 상세 거래 상태 변경 -->
<update id="TbrdbstModify"  parameterType="hashmap" >
	UPDATE T3_TBRD
	SET BSTATUS=#{bstatus}
	WHERE TBNO= #{tbno}
</update>

<insert id="jimAdd" parameterType="hashmap" >
	INSERT INTO T3_JJIM
	VALUES(NULL,#{id},#{tbno});
</insert>
<!-- 게시글 찜 갯수 -->
<select id="selectjimcnt" parameterType="hashmap" resultType="int">
	SELECT COUNT(JJNO) AS JIMCNT
	FROM T3_JJIM 
	WHERE TBNO=#{tbno}
</select>
<!-- 사용자 찜 체크 -->
<select id="jimCnt" parameterType="hashmap" resultType="int">
	SELECT COUNT(JJNO) AS JIMCNT
	FROM T3_JJIM 
	WHERE ID=#{id} AND TBNO=#{tbno}
</select>

<delete id="jimDel" parameterType="hashmap" >
	DELETE 
	FROM T3_JJIM 
	WHERE ID=#{id} AND TBNO=#{tbno}
</delete>

<update id="BrdDel"  parameterType="hashmap" >
	UPDATE T3_TBRD
	SET DELYN="Y"
	WHERE TBNO= #{tbno}
</update>

<!-- 게시글 상세 댓글 -->
<insert id="TbrdcommAdd"  parameterType="hashmap" >
	INSERT INTO T3_CMRE 
	VALUES (NULL,#{tbno},NULL,#{id},#{conetent},NULL,NOW(),NULL,NULL,'0','N','N')
</insert>

<!-- 게시글 댓글 리스트 -->
<select id="selectsumcnt" parameterType="hashmap" resultType="int">
	SELECT COUNT(CNO) AS CNT
	FROM T3_CMRE 
	WHERE TBNO=#{tbno};
</select>

<select id="selectTbrdcomm" parameterType="hashmap" resultType="com.mini.model.Cmre">
SELECT 
	CNO,
	TBNO,
	CBNO,
	ID,
	CONTE,
	RECONTE,
	CDATE,
	UDATE,
	RECNO,
	REVWFLG,
	SHOWYN,
	DELYN
FROM T3_CMRE 
WHERE TBNO=#{tbno}
ORDER BY CNO ASC
</select>




</mapper>